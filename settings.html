<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defini√ß√µes - Mass & Balance</title>

    <link rel="stylesheet" href="design.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="auto-update.js" defer></script>
	<script src="app-version.js"></script>
	<script src="app.js" defer></script>
    
    <style>
        /* --- Estilos para as modais --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 90%;
            box-sizing: border-box;
        }

        .button-danger {
            background-color: var(--danger, #ff4d4d);
        }

        .button-danger:hover {
            background-color: #d32f2f;
        }

        .modal-content .action-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
        }

        /* Estilos de layout */
        body {
            padding: 1rem;
            box-sizing: border-box;
        }

        h2, h3 {
            text-align: center;
        }

        hr {
            margin: 30px 0;
            border: none;
            border-top: 1px solid #999;
        }

        /* Estilos para tabelas e inputs */
        table {
            width: 100%;
            table-layout: auto;
            border-collapse: collapse;
        }

        table th,
        table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: keep-all;
            padding: 0.5rem;
        }

        table colgroup col:nth-child(1) { width: 25%; }
        table colgroup col:nth-child(2) { width: 15%; }
        table colgroup col:nth-child(3) { width: 15%; }
        table colgroup col:nth-child(4) { width: 15%; }
        table colgroup col:nth-child(5) { width: 15%; }
        table colgroup col:nth-child(6) { width: 15%; }
        
        input,
        select,
        textarea {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="settings-page">

    <div class="top-buttons">
        <button onclick="location.href='index.html'" title="Voltar para a Calculadora">‚¨ÖÔ∏è</button>
        <button onclick="abrirModalQR()" title="Partilhar App">üì≤</button>
    </div>

    <div id="modalQR" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModalQR()">&times;</span>
            <h3>üì≤ Partilhar App</h3>
            <p>Aponta a c√¢mara para o QR code:</p>
            <img src="qr_mb_d228.png" alt="QR Code" style="width: 200px; height: 200px; border: 1px solid #ccc; background: white; padding: 10px;">
        </div>
    </div>

    <div id="modalReset" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModalReset()">&times;</span>
            <h3>‚ö†Ô∏è Confirmar Reset</h3>
            <p>Tem a certeza que quer repor todas as defini√ß√µes? As suas altera√ß√µes (avi√µes, rotas, etc.) ser√£o perdidas.</p>
            <div class="action-buttons">
                <button class="button-danger" onclick="resetarDefinicoes()">Sim, Repor</button>
                <button onclick="fecharModalReset()">Cancelar</button>
            </div>
        </div>
    </div>

    <hr>
    
    <h2>Defini√ß√µes de Pesos Padr√£o</h2>
    <label>Peso padr√£o - Homem (kg):
        <input type="number" inputmode="decimal" step="any" id="pesoHomem" value="86" onfocus="this.select()">
    </label>
    <label>Peso padr√£o - Mulher (kg):
        <input type="number" inputmode="decimal" step="any" id="pesoMulher" value="68" onfocus="this.select()">
    </label>
    <label>Peso padr√£o - Crian√ßa (kg):
        <input type="number" inputmode="decimal" step="any" id="pesoCrianca" value="35" onfocus="this.select()">
    </label>
    <label>Peso padr√£o - Bagagem extra (kg):
        <input type="number" inputmode="decimal" step="any" id="pesoBagagem" value="10" onfocus="this.select()">
    </label>

    <hr>

    <h2>Avi√µes Dispon√≠veis</h2>
    <table>
        <colgroup>
            <col>
            <col>
            <col>
            <col>
            <col>
            <col>
            <col>
        </colgroup>
        <thead>
            <tr>
                <th>Nome</th>
                <th>BEW</th>
                <th>Momento</th>
                <th>MRW</th>
                <th>MTOW</th>
                <th>MLW</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="tabelaAvioes"></tbody>
    </table>

    <h3>Adicionar Novo Avi√£o</h3>
    <input type="text" id="novoNome" placeholder="Nome do avi√£o">
    <input type="number" inputmode="decimal" step="any" id="novoPeso" placeholder="Peso (kg)" onfocus="this.select()">
    <input type="number" inputmode="decimal" step="any" id="novoMomento" placeholder="Momento" onfocus="this.select()">
    <input type="number" inputmode="decimal" step="any" id="novoMRW" placeholder="MRW" onfocus="this.select()">
    <input type="number" inputmode="decimal" step="any" id="novoMTOW" placeholder="MTOW" onfocus="this.select()">
    <input type="number" inputmode="decimal" step="any" id="novoMLW" placeholder="MLW" onfocus="this.select()">
    <button onclick="adicionarAviao()">Adicionar Avi√£o</button>

    <hr>
    
    <h2>Rotas Padr√£o</h2>
    <label>Nome da Rota: <input type="text" id="nomeRota" placeholder="Ex: RVP952/953"></label>
    <button onclick="adicionarLinhaRota()">+ Adicionar Leg</button>
    <table>
        <thead>
            <tr><th>ROUTE</th><th>DEP F. (lb)</th><th>PAYL. (kg)</th><th>TRIP F. (lb)</th><th>Remover</th></tr>
        </thead>
        <tbody id="rotaTemp"></tbody>
    </table>

    <h3>Rotas Guardadas</h3>
    <ul id="listaRotas">
        </ul>

    <hr>
    
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 10px;">
		<button class="button-danger" onclick="abrirModalReset()">Reset Defini√ß√µes</button>
		<div>
			<button onclick="forcarUpdate()">üîÑ For√ßar atualiza√ß√£o</button>
			<button onclick="guardarDefinicoes()">Guardar</button>
		</div>
	</div>


	<!-- Banner de atualiza√ß√£o escondido por defeito -->
	<div id="update-banner" style="display:none; position:fixed; bottom:0; width:100%; background:#333; color:#fff; padding:10px; text-align:center; z-index:9999; font-size:14px;">
	  ‚ö†Ô∏è Nova vers√£o dispon√≠vel!
	  <button style="margin-left:20px; padding:6px 12px; font-size:14px; cursor:pointer; background:#fff; color:#333; border:none; border-radius:4px; font-weight:bold;">
		Atualizar agora
	  </button>
	</div>



    <footer style="text-align: right; margin-top: 30px; font-size: 12px; color: #888;">
        <span id="versaoApp"></span>
    </footer>

	
	<script>
    (function () {
      const el = document.getElementById('versaoApp');
      if (!el) return;
      fetch('./app-version.js', { cache: 'no-store' })
        .then(r => r.ok ? r.text() : Promise.reject())
        .then(code => {
          const m = code.match(/APP_VERSION\s*=\s*['"`]([^'"`]+)['"`]/);
          const v = m && m[1] ? m[1] : null;
          el.textContent = 'Vers√£o: ' + (v || 'desconhecida');
        })
        .catch(() => {
          el.textContent = 'Vers√£o: ' + (window.APP_VERSION || 'desconhecida');
        });
    })();
	</script>

    <script>
	async function forcarUpdate() {
	  if ('serviceWorker' in navigator) {
		try {
		  const reg = await navigator.serviceWorker.getRegistration();
		  if (reg) {
			await reg.update(); // procura um SW novo
			if (reg.waiting) {
			  reg.waiting.postMessage({ action: 'skipWaiting' });
			}
			window.location.reload(); // recarrega com a vers√£o nova
		  } else {
			alert("Nenhum service worker registado.");
		  }
		} catch (e) {
		  console.error("Erro ao for√ßar update:", e);
		  alert("Falha ao tentar atualizar.");
		}
	  } else {
		alert("Service Worker n√£o suportado neste browser.");
	  }
	}
	</script>
	
</body>
</html>
